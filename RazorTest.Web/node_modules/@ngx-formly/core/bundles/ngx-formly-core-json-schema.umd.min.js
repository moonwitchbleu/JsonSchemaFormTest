!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@ngx-formly/core"),require("@angular/forms")):"function"==typeof define&&define.amd?define("@ngx-formly/core/json-schema",["exports","@angular/core","@ngx-formly/core","@angular/forms"],t):t((e["ngx-formly"]=e["ngx-formly"]||{},e["ngx-formly"].core=e["ngx-formly"].core||{},e["ngx-formly"].core["json-schema"]={}),e.ng.core,e["ngx-formly"].core,e.ng.forms)}(this,function(e,t,l,i){"use strict";var s=function(){return(s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function f(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),u=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)u.push(n.value)}catch(a){i={error:a}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(i)throw i.error}}return u}function m(e){return""===e||e===undefined||null===e}function o(e){e.options._checkField(e)}function u(e){return e.key?e.formControl.valid:e.fieldGroup.every(function(e){return u(e)})}var r=function(){function e(){}return e.prototype.toFieldConfig=function(e,t){return this._toFieldConfig(e,s({schema:e},t||{}))},e.prototype._toFieldConfig=function(n,t){var i=this;n=this.resolveSchema(n,t);var o={type:this.guessType(n),defaultValue:n["default"],templateOptions:{label:n.title,readonly:n.readOnly,description:n.description}};switch(o.type){case"null":this.addValidator(o,"null",function(e){return null===e.value});break;case"number":case"integer":o.parsers=[function(e){return m(e)?null:Number(e)}],n.hasOwnProperty("minimum")&&(o.templateOptions.min=n.minimum),n.hasOwnProperty("maximum")&&(o.templateOptions.max=n.maximum),n.hasOwnProperty("exclusiveMinimum")&&(o.templateOptions.exclusiveMinimum=n.exclusiveMinimum,this.addValidator(o,"exclusiveMinimum",function(e){var t=e.value;return m(t)||t>n.exclusiveMinimum})),n.hasOwnProperty("exclusiveMaximum")&&(o.templateOptions.exclusiveMaximum=n.exclusiveMaximum,this.addValidator(o,"exclusiveMaximum",function(e){var t=e.value;return m(t)||t<n.exclusiveMaximum})),n.hasOwnProperty("multipleOf")&&(o.templateOptions.step=n.multipleOf,this.addValidator(o,"multipleOf",function(e){var t=e.value;return m(t)||t%n.multipleOf==0}));break;case"string":var e=n.type;Array.isArray(e)&&e.includes("null")&&(o.parsers=[function(e){return m(e)?null:e}]),["minLength","maxLength","pattern"].forEach(function(e){n.hasOwnProperty(e)&&(o.templateOptions[e]=n[e])});break;case"object":o.fieldGroup=[];var r=f(this.resolveDependencies(n),2),u=r[0],a=r[1];Object.keys(n.properties||{}).forEach(function(r){var e=i._toFieldConfig(n.properties[r],t);o.fieldGroup.push(e),e.key=r,Array.isArray(n.required)&&-1!==n.required.indexOf(r)&&(e.templateOptions.required=!0),!e.templateOptions.required&&u[r]&&(e.expressionProperties={"templateOptions.required":function(t){return t&&u[r].some(function(e){return!m(t[e])})}}),a[r]&&o.fieldGroup.push(s({},i._toFieldConfig(a[r],t),{hideExpression:function(e){return!e||m(e[r])}}))}),n.oneOf&&o.fieldGroup.push(this.resolveMultiSchema(n.oneOf,t)),n.anyOf&&o.fieldGroup.push(this.resolveMultiSchema(n.anyOf,t));break;case"array":n.hasOwnProperty("minItems")&&(o.templateOptions.minItems=n.minItems,this.addValidator(o,"minItems",function(e){var t=e.value;return m(t)||t.length>=n.minItems})),n.hasOwnProperty("maxItems")&&(o.templateOptions.maxItems=n.maxItems,this.addValidator(o,"maxItems",function(e){var t=e.value;return m(t)||t.length<=n.maxItems})),n.hasOwnProperty("uniqueItems")&&(o.templateOptions.uniqueItems=n.uniqueItems,this.addValidator(o,"uniqueItems",function(e){var t=e.value;return!(!m(t)&&n.uniqueItems)||Array.from(new Set(t.map(function(e){return JSON.stringify(e)}))).length===t.length})),n.items&&!Array.isArray(n.items)&&(n.items=this.resolveSchema(n.items,t)),this.isEnum(n)||(o.fieldGroup=[],Object.defineProperty(o,"fieldArray",{get:function(){if(!Array.isArray(n.items))return i._toFieldConfig(n.items,t);var e=n.items[o.fieldGroup.length]?n.items[o.fieldGroup.length]:n.additionalItems;return e?i._toFieldConfig(e,t):{}},enumerable:!0,configurable:!0}))}return n.hasOwnProperty("const")&&(o.templateOptions["const"]=n["const"],this.addValidator(o,"const",function(e){return e.value===n["const"]}),o.type||(o.defaultValue=n["const"])),this.isEnum(n)&&(o.templateOptions.multiple="array"===o.type,o.type="enum",o.templateOptions.options=this.toEnumOptions(n)),n.widget&&n.widget.formlyConfig&&(o=l.ɵreverseDeepMerge(n.widget.formlyConfig,o)),t.map?t.map(o,n):o},e.prototype.resolveSchema=function(e,t){return e.$ref&&(e=this.resolveDefinition(e,t)),e.allOf&&(e=this.resolveAllOf(e,t)),e},e.prototype.resolveAllOf=function(e,i){var o=this,t=e.allOf,r=function u(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["allOf"]);if(!t.length)throw Error("allOf array can not be empty "+t+".");return t.reduce(function(t,r){return r=o.resolveSchema(r,i),t.required&&r.required&&(t.required=function n(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(f(arguments[t]));return e}(t.required,r.required)),r.uniqueItems&&(t.uniqueItems=r.uniqueItems),["maxLength","maximum","exclusiveMaximum","maxItems","maxProperties"].forEach(function(e){m(t[e])||m(r[e])||(t[e]=t[e]<r[e]?t[e]:r[e])}),["minLength","minimum","exclusiveMinimum","minItems","minProperties"].forEach(function(e){m(t[e])||m(r[e])||(t[e]=t[e]>r[e]?t[e]:r[e])}),l.ɵreverseDeepMerge(t,r)},r)},e.prototype.resolveMultiSchema=function(e,t){var r=this,n=null;return{type:"multischema",fieldGroup:[{type:"enum",templateOptions:{options:e.map(function(e,t){return{label:e.title,value:t}})},hooks:{onInit:function(e){var r=e.parent.fieldGroup[1],t=r.fieldGroup.findIndex(u);e.formControl=new i.FormControl(-1!==t?t:0),setTimeout(function(){return o(r)}),n=e.formControl.valueChanges.subscribe(function(e){!function t(e){e.key?(e.formControl.patchValue(undefined),delete e.model[e.key]):e.fieldGroup&&e.fieldGroup.forEach(function(e){return t(e)})}(r),o(r)})},onDestroy:function(){n&&n.unsubscribe()}}},{fieldGroup:e.map(function(e,i){return s({},r._toFieldConfig(e,t),{hideExpression:function(e,t,r){var n=r.parent.parent.fieldGroup[0].formControl;return!n||n.value!==i}})})}]}},e.prototype.resolveDefinition=function(r,e){var t=f(r.$ref.split("#/"),2),n=t[0],i=t[1];if(n)throw Error("Remote schemas for "+r.$ref+" not supported yet.");var o=i?i.split("/").reduce(function(e,t){return e&&e.hasOwnProperty(t)?e[t]:null},e.schema):null;if(!o)throw Error("Cannot find a definition for "+r.$ref+".");return o.$ref?this.resolveDefinition(o,e):s({},o,["title","description","default"].reduce(function(e,t){return r.hasOwnProperty(t)&&(e[t]=r[t]),e},{}))},e.prototype.resolveDependencies=function(r){var n={},i={};return Object.keys(r.dependencies||{}).forEach(function(t){var e=r.dependencies[t];Array.isArray(e)?e.forEach(function(e){n[e]?n[e].push(t):n[e]=[t]}):i[t]=e}),[n,i]},e.prototype.guessType=function(e){var t=e.type;if(!t&&e.properties)return"object";if(Array.isArray(t)){if(1===t.length)return t[0];if(2===t.length&&t.includes("null"))return t["null"===t[0]?1:0]}return t},e.prototype.addValidator=function(e,t,r){e.validators=e.validators||{},e.validators[t]=r},e.prototype.isEnum=function(e){var t=function(e){return e.hasOwnProperty("const")||e["enum"]&&1===e["enum"].length};return e["enum"]||e.anyOf&&e.anyOf.every(t)||e.oneOf&&e.oneOf.every(t)||e.uniqueItems&&e.items&&!Array.isArray(e.items)&&this.isEnum(e.items)},e.prototype.toEnumOptions=function(e){if(e["enum"])return e["enum"].map(function(e){return{value:e,label:e}});var t=function(e){var t=e.hasOwnProperty("const")?e["const"]:e["enum"][0];return{value:t,label:e.title||t}};return e.anyOf?e.anyOf.map(t):e.oneOf?e.oneOf.map(t):this.toEnumOptions(e.items)},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=t.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}();e.FormlyJsonschema=r,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-formly-core-json-schema.umd.min.js.map